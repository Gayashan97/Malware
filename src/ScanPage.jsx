import React, { useEffect, useState } from 'react';
import { Pie } from 'react-chartjs-2';
import { Chart as ChartJS, ArcElement, Tooltip, Legend } from 'chart.js';
import { collection, getDocs, query } from 'firebase/firestore';
import db from './firebaseConfig';

ChartJS.register(ArcElement, Tooltip, Legend);

async function GetData(setUsers, setActiveUsers){
  await getDocs(collection(db, 'users')).then((value) => {
    const usersList = []
    const activeUsers = []
    
    value.forEach((data) => {
      usersList.push(data)
    })

    value.docs.forEach((val, ind, arr) => {
      if(val.data().isActive === true){
        activeUsers.push(val.data())
      }
    })

    setUsers(usersList.length)
    setActiveUsers(activeUsers.length)
  })
}

const ScanPage = () => {

  const [users, setUsers] = useState([])
  const [activeUsers, setActiveUsers] = useState([])
  useEffect(() => {
    GetData(setUsers, setActiveUsers)
  }, [users, activeUsers])

  const data = {
    labels: ['Trojan', 'Worm', 'Keylogger', 'Ransomware', 'Adware'],
    datasets: [
      {
        label: 'Total Scanned Malware',
        data: [246, 154, 140, 198, 255], // Example data
        backgroundColor: [
          '#ff6384', // Trojan
          '#36a2eb', // Worm
          '#ffce56', // Keylogger
          '#4bc0c0', // Ransomware
          '#9966ff', // Adware
        ],
        hoverBackgroundColor: [
          '#ff6384',
          '#36a2eb',
          '#ffce56',
          '#4bc0c0',
          '#9966ff',
        ],
      },
    ],
  };

  return (
    <div className="scan-page-container">
      <div className="stats-container">
        <div className="stat-box">
          <h3>Users</h3>
          <p>{users.length === 0 ? '-' : users}</p>
        </div>
        <div className="stat-box">
          <h3>Active Users</h3>
          <p>{activeUsers.length === 0 ?'-' : activeUsers}</p>
        </div>
        <div className="stat-box">
          <h3>Total Scans</h3>
          <p>468</p>
        </div>
        <div className="stat-box">
          <h3>Dataset Files</h3>
          <p>3</p>
        </div>
      </div>

      <div className="malware-chart">
        <h3>Total Scanned Malware</h3>
        <Pie data={data} />
      </div>
    </div>
  );
};

export default ScanPage;
